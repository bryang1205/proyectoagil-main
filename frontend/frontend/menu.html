<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Men√∫ - Sistema de Restaurante</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background-color: #f5f7fa; min-height: 100vh; }

    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1);}
    .header-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;}
    .header h1 { font-size: 1.5rem; font-weight: 600; }
    .btn-back { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; text-decoration: none; transition: all 0.3s;}
    .btn-back:hover { background: rgba(255,255,255,0.3); }
    
    .container { max-width: 1400px; margin: 2rem auto; padding: 0 2rem; }

    /* Filtros */
    .filters { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 2rem; display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
    .filter-btn { padding: 0.7rem 1.5rem; border: 2px solid #e0e0e0; background: white; border-radius: 8px; cursor: pointer; font-weight: 600; color: #666; transition: all 0.3s; }
    .filter-btn:hover { border-color: #667eea; color: #667eea; }
    .filter-btn.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-color: transparent; }
    
    .search-box { flex: 1; min-width: 250px; }
    .search-box input { width: 100%; padding: 0.7rem 1rem 0.7rem 2.5rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; }
    .search-box { position: relative; }
    .search-icon { position: absolute; left: 0.8rem; top: 50%; transform: translateY(-50%); color: #999; }

    /* --- INICIO: CSS PARA EL TOGGLE SWITCH --- */
    .toggle-switch-container {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 1rem;
      border-left: 2px solid #f0f0f0;
      margin-left: auto; /* Empuja el switch a la derecha */
    }
    .toggle-switch-container label {
      font-weight: 600;
      color: #555;
      cursor: pointer;
    }
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 28px;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 28px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: #667eea;
    }
    input:checked + .slider:before {
      transform: translateX(22px);
    }
    /* --- FIN: CSS PARA EL TOGGLE SWITCH --- */

    /* Grid de productos */
    .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 2rem; }
    
    .product-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s; cursor: pointer; }
    .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
    
    .product-image { width: 100%; height: 220px; object-fit: cover; background: linear-gradient(135deg, #f5f7fa 0%, #e8eaf0 100%); display: flex; align-items: center; justify-content: center; font-size: 4rem; color: #ccc; }
    .product-image img { width: 100%; height: 100%; object-fit: cover; }
    
    .product-info { padding: 1.5rem; }
    .product-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem; }
    .product-name { font-size: 1.1rem; font-weight: 600; color: #2c3e50; }
    .product-price { font-size: 1.3rem; font-weight: 700; color: #667eea; }
    .product-description { color: #7f8c8d; font-size: 0.9rem; margin: 0.5rem 0 1rem; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    
    .product-footer { display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid #f0f0f0; }
    .product-category { background: #f8f9fa; color: #666; padding: 0.3rem 0.7rem; border-radius: 6px; font-size: 0.85rem; font-weight: 600; }
    .product-stock { font-size: 0.85rem; font-weight: 600; }
    .stock-disponible { color: #27ae60; }
    .stock-agotado { color: #e74c3c; }

    .empty-state { text-align: center; padding: 4rem 2rem; color: #7f8c8d; }
    .empty-icon { font-size: 5rem; margin-bottom: 1rem; opacity: 0.5; }

    @media (max-width: 992px) { /* Ajuste para que el switch se mueva abajo antes */
      .toggle-switch-container {
        width: 100%;
        border-left: none;
        padding-left: 0;
        margin-left: 0;
        justify-content: flex-end; /* Lo alinea a la derecha en m√≥vil */
      }
    }

    @media (max-width: 768px) {
      .filters { flex-direction: column; align-items: stretch; }
      .filter-btn { width: 100%; }
      .toggle-switch-container {
        justify-content: center; /* Lo centra en pantallas muy peque√±as */
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-content">
      <h1>üçΩ Men√∫ del Restaurante</h1>
      <a href="dashboard.html" class="btn-back">‚Üê Volver</a>
    </div>
  </div>

  <div class="container">
    <div class="filters">
      <button class="filter-btn active" onclick="filterByCategory('todas', this)">Todas</button>
      <button class="filter-btn" onclick="filterByCategory('entradas', this)">ü•ó Entradas</button>
      <button class="filter-btn" onclick="filterByCategory('platos principales', this)">üçñ Platos Principales</button>
      <button class="filter-btn" onclick="filterByCategory('postres', this)">üç∞ Postres</button>
      <button class="filter-btn" onclick="filterByCategory('bebidas', this)">ü•§ Bebidas</button>
      
      <div class="search-box">
        <span class="search-icon">üîç</span>
        <input type="text" id="searchInput" placeholder="Buscar platillos..." onkeyup="applyAllFilters()">
      </div>

      <div class="toggle-switch-container">
        <label for="stockToggle">Solo disponibles</label>
        <label class="toggle-switch">
          <input type="checkbox" id="stockToggle" onchange="applyAllFilters()">
          <span class="slider"></span>
        </label>
      </div>
      </div>

    <div class="products-grid" id="productsGrid">
      </div>
  </div>

  <script>
    let allProducts = [];
    let filteredProducts = [];

    async function loadProducts() {
      try {
        const response = await fetch("http://localhost:8082/api/productos");
        if (!response.ok) throw new Error('Network response was not ok');
        allProducts = await response.json();
        applyAllFilters();
      } catch (error) {
        console.error("Error al cargar productos:", error);
        document.getElementById('productsGrid').innerHTML = `
          <div class="empty-state" style="grid-column: 1/-1;">
            <div class="empty-icon">‚ö†Ô∏è</div>
            <h3>Error al cargar el men√∫</h3>
            <p>No se pudo conectar con el servidor. Por favor, intenta nuevamente m√°s tarde.</p>
          </div>
        `;
      }
    }

    function displayProducts() {
      const grid = document.getElementById('productsGrid');
      
      if (filteredProducts.length === 0) {
        grid.innerHTML = `
          <div class="empty-state" style="grid-column: 1/-1;">
            <div class="empty-icon">üçΩÔ∏è</div>
            <h3>No se encontraron productos</h3>
            <p>Intenta con otra b√∫squeda o filtro.</p>
          </div>
        `;
        return;
      }

      grid.innerHTML = filteredProducts.map(product => {
        const imageHtml = product.imagenUrl 
          ? `<img src="http://localhost:8082${product.imagenUrl}" alt="${product.nombre}" onerror="this.parentElement.innerHTML='üçΩÔ∏è'">`
          : 'üçΩÔ∏è';
        
        const stockClass = product.cantidad > 0 ? 'stock-disponible' : 'stock-agotado';
        const stockText = product.cantidad > 0 ? `‚úì Disponible (${product.cantidad})` : '‚úó Agotado';
        
        return `
          <div class="product-card">
            <div class="product-image">
              ${imageHtml}
            </div>
            <div class="product-info">
              <div class="product-header">
                <h3 class="product-name">${product.nombre}</h3>
                <span class="product-price">S/ ${product.precio.toFixed(2)}</span>
              </div>
              <p class="product-description">${product.descripcion}</p>
              <div class="product-footer">
                <span class="product-category">${product.categoria.nombre}</span>
                <span class="product-stock ${stockClass}">${stockText}</span>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function applyAllFilters() {
      const activeCategoryBtn = document.querySelector('.filter-btn.active');
      const category = activeCategoryBtn.getAttribute('onclick').match(/'([^']+)'/)[1];
      const showOnlyAvailable = document.getElementById('stockToggle').checked;
      const searchText = document.getElementById('searchInput').value.toLowerCase();

      let tempProducts = [...allProducts];

      if (category !== 'todas') {
        tempProducts = tempProducts.filter(p => p.categoria.nombre.toLowerCase() === category.toLowerCase());
      }

      if (showOnlyAvailable) {
        tempProducts = tempProducts.filter(p => p.cantidad > 0);
      }

      // Filtro por texto de b√∫squeda (MODIFICADO)
      if (searchText) {
        tempProducts = tempProducts.filter(p =>
          p.nombre.toLowerCase().includes(searchText)
        );
      }

      filteredProducts = tempProducts;
      displayProducts();
    }

    function filterByCategory(category, buttonElement) {
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      buttonElement.classList.add('active');
      applyAllFilters();
    }
    
    window.onload = loadProducts;
  </script>
</body>
</html>